#!/bin/sh

if ! mount | grep -q "/etc/profile"; then
    mount -o bind /mnt/SDCARD/sprig/etc/profile /etc/profile
fi

if [ ! -e /tmp/logs_rotated ]; then
    . /mnt/SDCARD/sprig/helperFunctions.sh
    rotate_logs
    log_message "sprigUI has entered the chat"
    touch /tmp/logs_rotated
fi

if ! pgrep adbd >/dev/null 2>&1; then
    /mnt/SDCARD/sprig/scripts/start_adbd.sh
fi

if ! pgrep dropbearmulti >/dev/null 2>&1; then
    /mnt/SDCARD/sprig/scripts/start_dropbear.sh
fi

if ! pgrep -f "/mnt/SDCARD/sprig/scripts/powerbutton_watchdog.sh" >/dev/null; then
    /mnt/SDCARD/sprig/scripts/powerbutton_watchdog.sh &
fi

# auto resume last app or game
if [ -e /mnt/SDCARD/sprig/flags/lastgame.lock ]; then
    ./freemma
    mv /mnt/SDCARD/sprig/flags/lastgame.lock /tmp/cmd_to_run.sh
    /tmp/cmd_to_run.sh
fi

./freemma
/mnt/SDCARD/App/PyUI/launch.sh
